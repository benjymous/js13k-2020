<body style=background:#000;cursor:none><svg id="c" viewBox="0 0 640 640" style="position:absolute;top:0;left:0;height:100%;width:100%"><style>.heavy{font:700 20px monospace}.big{font:30px monospace}.bigger{font:50px monospace}</style><clipPath id="clip"><path d="M0 0h640v640H0z"/></clipPath><filter id="g" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="z1"/><feGaussianBlur in="SourceGraphic" stdDeviation="2" result="z2"/><feGaussianBlur in="SourceGraphic" stdDeviation="8" result="z3"/><feMerge><feMergeNode in="z1"/><feMergeNode in="z2"/><feMergeNode in="z3"/></feMerge></filter><filter id="f1" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceGraphic" stdDeviation="1"/></filter><filter id="f3" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceGraphic" stdDeviation="3"/></filter><filter id="f10" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceGraphic" stdDeviation="10"/></filter><g clip-path="url(#clip)"><g id="title" filter="url(#f1)"><path fill="#000" d="M0 0h640v640H0"/><text x="15" y="100" fill="#fff" class="bigger">The Legend of Yeti-404</text><text x="300" y="150" fill="#fff" class="big">#js13k 2020</text><text x="15" y="550" fill="#fff" class="bigger">A game by Richard Munn</text></g><g id="orbit" filter="url(#f1)"><ellipse fill="#000" stroke-width="1.5" id="orbit_planet"/><ellipse fill="#000" stroke-width="1.5" id="orbit_moon"/><text x="20" y="40" fill="#fff" class="big">Currently in orbit at</text><text id="orbitcoords" x="400" y="40" fill="#fff" class="big">[0:0]</text><g id="orbitmap" transform="translate(0 80)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="orbitmaptext" x="50" y="25" fill="#fff" class="big">&gt; Galaxy Map</text></g><g id="orbitscan" transform="translate(0 110)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="orbitscantext" x="50" y="25" fill="#fff" class="big">&gt; Scan System</text></g><g id="orbitenter" transform="translate(0 140)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="orbitentertext" x="50" y="25" fill="#fff" class="big">&gt; Enter Atmosphere</text></g><text x="20" y="400" fill="#fff" class="big">System Information</text><text x="60" y="430" fill="#fff" class="big">Faction:</text><text id="infofaction" x="300" y="430" fill="#fff" class="big">Unknown</text><text x="60" y="460" fill="#fff" class="big">Economy:</text><text id="infotrade" x="300" y="460" fill="#fff" class="big">Unknown</text><text x="60" y="490" fill="#fff" class="big">Discovery:</text><text id="infopoi" x="300" y="490" fill="#fff" class="big">Unknown</text></g><g id="base" filter="url(#f1)"><text x="20" y="40" fill="#fff" class="big">Discovered</text><text id="tradename" x="200" y="40" fill="#fff" class="big">???</text><g id="tradeexit" transform="translate(0 80)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeexittext" x="50" y="25" fill="#fff" class="big">&lt; Return to orbit</text></g><g id="tradeitem1" transform="translate(0 130)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem1text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem2" transform="translate(0 160)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem2text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem3" transform="translate(0 190)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem3text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem4" transform="translate(0 220)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem4text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem5" transform="translate(0 250)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem5text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem6" transform="translate(0 280)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem6text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem7" transform="translate(0 310)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem7text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem8" transform="translate(0 340)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem8text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem9" transform="translate(0 370)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem9text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem10" transform="translate(0 400)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem10text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem11" transform="translate(0 430)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem11text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem12" transform="translate(0 460)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem12text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem13" transform="translate(0 490)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem13text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem14" transform="translate(0 520)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem14text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g><g id="tradeitem15" transform="translate(0 550)"><path d="M0 0h640v30H0z" fill="#000" fill-opacity=".1"/><text id="tradeitem15text" x="50" y="25" fill="#fff" class="big">&gt; Buy Item</text></g></g><g id="game"><g filter="url(#g)" id="l1"><g id="l10">.</g><g id="l11">.</g><path d="M0 0H640V640H-640z" fill="#000" fill-opacity=".1"/><g id="l12">.</g><path id="ship" d="M0 0" stroke-width=".2" stroke="#fff" fill-opacity="0"/></g></g><g filter="url(#f1)" id="map"><path d="M0 0h640v640H0z" fill="#000"/><path id="galaxy" filter="url(#f10)" fill="#fff2" d="M-20 355c0-160 125-310 3e2-310 135 0 245 95 245 230 0 85-65 175-165 175-90 0-135-55-135-125-15 0-25 25-25 50 0 65 80 135 170 135 120 0 250-110 250-275 0-1e2-50-190-90-240 50 45 130 130 130 270 0 160-125 310-295 310-135 0-245-95-245-230 0-85 65-175 165-175 90 0 135 55 135 125 15 0 25-25 25-50 0-65-80-135-170-135-120 0-250 110-250 275 0 1e2 50 190 90 240C55 580-20 495-20 355z"/><g id="mapexit" transform="translate(0 0)"><path d="M0 0h640v30H0z" fill="#000"/><text id="mapexittext" x="10" y="25" fill="#fff" class="big">&lt; Cancel</text></g></g><text filter="url(#f1)" id="bottomtext" x="10" y="630" fill="#ff0" class="heavy"/><path id="vsync" filter="url(#f10)" d="M-10 0H650V2e2H-640z" fill="#303" fill-opacity=".2" style="pointer-events:none"/><path id="cursor" filter="url(#g)" d="M-10 0h-30M0 0h30M-5 5v30m0-40v-30" stroke-width=".7" stroke="#fff" fill-opacity="0" style="pointer-events:none"/><g style="visibility:hidden"><path id="star" d="M-2-2h2v2h-2z"/><path id="box" d="M-10-10h20v20h-20z" fill-opacity="0"/><path id="enemybox" d="M0 0"/><path id="mapcell" d="M0 0h15v15H0z" fill-opacity="0"/><path id="ground" d="M0 0" stroke-width=".6" stroke="#fff" fill-opacity="0"/></g></g></svg><script>SN=function(t){null==t&&(t=Math),this.g3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var r=0;r<256;r++)this.p[r]=Math.floor(256*t.random());this.m=[];for(r=0;r<512;r++)this.m[r]=this.p[255&r]};SN.prototype.n=function(t,r){var i,h,o=(t+r)*(.5*(Math.sqrt(3)-1)),s=Math.floor(t+o),e=Math.floor(r+o),p=(3-Math.sqrt(3))/6,a=(s+e)*p,m=t-(s-a),n=r-(e-a);m>n?(i=1,h=0):(i=0,h=1);var d=m-i+p,f=n-h+p,l=m-1+2*p,u=n-1+2*p,M=255&s,g=255&e,v=this.m[M+this.m[g]]%12,c=this.m[M+i+this.m[g+h]]%12,x=this.m[M+1+this.m[g+1]]%12,N=.5-m*m-n*n,S=.5-d*d-f*f,q=.5-l*l-u*u;return 70*((N<0?0:(N*=N)*N*dot(this.g3[v],m,n))+(S<0?0:(S*=S)*S*dot(this.g3[c],d,f))+(q<0?0:(q*=q)*q*dot(this.g3[x],l,u)))};sn=new SN();a=_=>{p="";f=m=>p+=`M${((i>>5&1)-X*m/7)} ${(j>>8)-4+Y}h1v1h-1v-1  `;for(j=30;j--;Math.random()>(X**2+(Y-4)**2)**.5/5&&f(7)+f(-7))X=j&3,Y=j>>2&7;return p};d=o=>{s=o.getAttribute("d").split("  ");for(i=0;i<s.length;++i){p=o.cloneNode();p.removeAttribute("id");p.setAttribute("d",s[i]);p.d={x:o.d.x,ry:o.d.ry,r:o.d.r,s:o.d.s,z:o.d.z,dx:o.d.dx+Math.random()*6-3,dy:o.d.dy+Math.random()*6-3,a:1};p.d.u=(o,g)=>{o.d.x+=o.d.dx;o.d.ry+=o.d.dy;o.d.y=250-o.d.ry+gh*(o.d.z*2);o.d.a-=0.01;if(o.d.a<=0){o.d.d=true};o.setAttribute("fill-opacity",o.d.a);u(o)};l12.appendChild(p);objects.push(p)}};_clamp_=(i,n,x)=>i<n?n:i>x?x:i;dot=(t,r,i)=>t[0]*r+t[1]*i;sqr=x=>x*x;itemvalue=(item,f)=>(item.z*f.z)+(item.y*f.y)+(item.x*f.x);u=o=>o.setAttribute("transform","translate("+o.d.x+" "+o.d.y+") rotate("+o.d.r+") scale("+o.d.z+")");s=o=>o.removeAttribute("style");h=o=>o.setAttribute("style","visibility:hidden");text=o=>bottomtext.textContent=o;showtitle=_=>{gameloop=false;h(game);h(orbit);h(map);s(title);h(base);text()};showmap=_=>{gameloop=false;h(game);h(orbit);s(map);h(title);h(base);text()};showgame=_=>{gameloop=true;s(game);h(orbit);h(map);h(title);h(base);text();f=fmp[ship.d.my][ship.d.mx];waves=f.e?0:1+f.z*f.z;wavecount=0;enemies=0;missiles=0;maxmissiles=8;targetc=0;wavetime=100};showorbit=_=>{gameloop=false;h(game);s(orbit);h(map);h(title);h(base);text();orbitcoords.textContent=`[${ship.d.mx},${ship.d.my}]`;f=fmp[ship.d.my][ship.d.mx];f.v=true;if(f.s){infofaction.textContent=factions[f.faction].name;orbit_planet.setAttribute("cx",Math.random()*640);orbit_planet.setAttribute("cy",Math.random()*640);orbit_planet.setAttribute("rx",f.pradius);orbit_planet.setAttribute("ry",f.pradius);orbit_planet.setAttribute("stroke",f.pcol);orbit_moon.setAttribute("cx",Math.random()*640);orbit_moon.setAttribute("cy",Math.random()*640);orbit_moon.setAttribute("rx",f.mradius);orbit_moon.setAttribute("ry",f.mradius);orbit_moon.setAttribute("stroke",f.mcol);infotrade.textContent=f.e;infopoi.textContent=f.e?places[f.p].name:"???"}else{infofaction.textContent="Unknown";infotrade.textContent="Unknown";infopoi.textContent="Unknown"};updatemap(ship.d.mx,ship.d.my)};showwarp=_=>showorbit();addMenu=(text,i,d,f)=>{if(i>15)return;item=document.getElementById(`tradeitem${i}`);s(item);itemtext=document.getElementById(`tradeitem${i}text`);itemtext.textContent="> "+text;item.d=d;t(item,itemtext,f)};hideMenu=i=>{item=document.getElementById(`tradeitem${i}`);h(item)};showtrade=_=>{gameloop=false;h(game);h(orbit);h(map);h(title);s(base);text();f=fmp[ship.d.my][ship.d.mx];f.e=true;next=1;tradename.textContent=places[f.p].name;text(`Kredits: ${kredits}`);if(f.y==0){addMenu("Search for scrap",next++,{},_=>{next=1;for(i=0;i<f.items.length;++i){addMenu(`Found ${items[f.items[i]].name}!`,next++,{},_=>{});inventory.push(f.items[i])};f.items=[]});hideMenu(next++)}else{for(i=0;i<f.items.length;++i){v=itemvalue(items[f.items[i]],f);addMenu(`Buy ${items[f.items[i]].name} : Kr${v}`,next++,{i:f.items[i],v:v},_=>{d=_.target.parentElement.d;if(kredits>=d.v){inventory.push(d.i);kredits-=d.v;f.items.splice(f.items.indexOf(d.i),1);showtrade()}})};if(f.items.length>0)hideMenu(next++);for(i=0;i<inventory.length;++i){v=Math.round(itemvalue(items[inventory[i]],f)*0.8);addMenu(`Sell ${items[inventory[i]].name} : Kr${v}`,next++,{i:inventory[i],v:v},_=>{d=_.target.parentElement.d;f.items.push(d.i);kredits+=d.v;inventory.splice(inventory.indexOf(d.i),1);showtrade()})}};while(next<16){hideMenu(next++)}};cols=["#f00","#f70","#ff0","#7f0","#0f0","#0f7","#0ff","#07f","#00f","#70f","#f0f","#f07"];factionCol=["#000","#f0f","#ff0","#05f"];factions=[{name:"Unclaimed",x:1,y:1,z:1},{name:"Federation",x:3,y:6,z:1},{name:"Union",x:5,y:4,z:1},{name:"Empire",x:1,y:3,z:6}];items=[{w:30,name:"Assorted Junk",x:1,y:1,z:1},{w:40,name:"Salvage",x:2,y:2,z:1},{w:45,name:"Strange foodstuffs",x:1,y:2,z:1},{w:60,name:"Mysterious boxes",x:6,y:3,z:1},{w:63,name:"Odd trinkets",x:1,y:4,z:1},{w:65,name:"Small furry creatures",x:5,y:7,z:1},{w:68,name:"Lab grown meat",x:3,y:2,z:4},{w:72,name:"Service robots",x:5,y:4,z:2},{w:75,name:"Entertainment devices",x:2,y:6,z:2},{w:80,name:"Exotic weapons",x:4,y:6,z:9},{w:90,name:"Luxury goods",x:4,y:8,z:5},{w:100,name:"Advanced technology",x:7,y:9,z:8}];places=[{w:50,name:"Trading Post",y:1,s:0,x:1},{w:70,name:"Abandoned colony",y:0,s:2,x:1},{w:80,name:"Small colony",y:2,s:0,x:1},{w:89,name:"Crashsite",y:0,s:3,x:1},{w:95,name:"Medium colony",y:3,s:0,x:1},{w:98,name:"Ancient Ruins",y:0,s:5,x:1},{w:100,name:"Large colony",y:4,s:0,x:1}];getWeighted=_=>{r=Math.random()*100;for(j=0;j<_.length;++j){if(_[j].w>r)return j}};targets=[];shipcell=null;objects=[];fxobjects=[];inventory=[];mousedown=false;kredits=25;shields=100;fuel=100;warpdistance=0;calcfuel=d=>sqr(Math.abs(d.x-ship.d.mx))+sqr(Math.abs(d.y-ship.d.my));music=null;title.onclick=_=>{showorbit()};ship.d={r:0,x:320,y:550,z:10,mx:10+Math.floor(Math.random()*12),my:10+Math.floor(Math.random()*12)};ship.d.u=(o,g)=>{o.d.x=(o.d.x*0.8+(320+(mx*320))*0.2);o.d.y=(o.d.y*0.8+(400+(my*100))*0.2);gh=27.5-(my*12.5);gx-=((o.d.x-320)/3000);ship.setAttribute("d",`M${(320-o.d.x)/100} ${(o.d.y-400)/50} L-5 4 L0 8 L5 4 Z M-5 4 L0 1 L5 4`);u(o)};objects.push(ship);u(ship);fmp=[];for(y=0;y<32;++y){fmp[y]=[];for(x=0;x<32;++x){dist=Math.sqrt((x-ship.d.mx)*(x-ship.d.mx)+(y-ship.d.my)*(y-ship.d.my));f={faction:0,v:false,e:false,s:dist<5,p:getWeighted(places),items:[],pradius:100+Math.random()*300,pcol:cols[Math.floor(Math.random()*cols.length)],mradius:10+Math.random()*100,mcol:cols[Math.floor(Math.random()*cols.length)]};f.x=Math.floor(Math.random()*3*factions[f.faction].x*places[f.p].x);f.y=Math.round((1+Math.random()*2)*factions[f.faction].y*places[f.p].y);f.z=Math.floor(Math.random()*3*factions[f.faction].z);f.s=Math.round(Math.random()*3*factions[f.faction].y*places[f.p].s);if(f.x==f.y&&f.x==f.z){f.e="balanced"}else if(f.x==f.y&&f.x>f.z){f.e="technology"}else if(f.x>f.y&&f.x>f.z){f.e="science"}else if(f.y>f.x&&f.y>f.z){f.e="trade"}else if(f.y>f.x&&f.y==f.z){f.e="arms"}else if(f.z>f.y&&f.z>f.x){f.e="warfare"}else if(f.x==f.z&&f.z>f.y){f.e="espionage"};for(i=0;i<1+(f.y+f.s);++i){f.items.push(getWeighted(items))};fmp[y][x]=f}};x=10+Math.floor(Math.random()*22);y=10+Math.floor(Math.random()*22);for(i=1;i<4;++i){factionSize=50+Math.floor(Math.random()*250);while(fmp[y][x].faction!=0){x=10+Math.floor(Math.random()*22);y=10+Math.floor(Math.random()*22)};fmp[y][x].faction=i;seeds=[];seeds.push([x,y]);j=0;fail=0;while(j<factionSize&&fail<500){v=seeds[Math.floor(Math.random()*seeds.length)];x=_clamp_(v[0]-5+Math.floor(Math.random()*10),0,31);y=_clamp_(v[1]-5+Math.floor(Math.random()*10),0,31);if(fmp[y][x].faction==0){fmp[y][x].faction=i;seeds.push([x,y]);++j}else{fail++}}};t=(e,t,f)=>{e.onmouseenter=_=>t.setAttribute("fill","#990");e.onmouseleave=_=>t.setAttribute("fill","#fff");e.onclick=_=>f(_)};t(orbitmap,orbitmaptext,_=>showmap());t(orbitscan,orbitscantext,_=>{fmp[ship.d.my][ship.d.mx].s=true;updatemap(ship.d.mx,ship.d.my);showorbit()});t(orbitenter,orbitentertext,_=>showtrade());t(mapexit,mapexittext,_=>showorbit());t(tradeexit,tradeexittext,_=>showorbit());updatemap=(x,y)=>{if(fmp[y][x].s){fmp[y][x].mapcell.setAttribute("fill",factionCol[fmp[y][x].faction]);fmp[y][x].mapcell.setAttribute("fill-opacity",fmp[y][x].v?"0.6":"0.25")}};lrs=(x,y,r)=>{for(y1=_clamp_(y-r,0,31);y1<_clamp_(y+r,0,31);++y1){for(x1=_clamp_(x-r,0,31);x1<_clamp_(x+r,0,31);++x1){if(dist<=Math.sqrt(sqr(x-x1)+sqr(y-y1))){fmp[y1][x1].s=true;updatemap(x1,y1)}}}};for(y=0;y<32;++y){for(x=0;x<32;++x){o=mapcell.cloneNode();o.d={x:x,y:y};if(x==ship.d.mx&&y==ship.d.my){o.setAttribute("stroke","#ff0");shipcell=o}else{o.setAttribute("stroke","#fff2")};fmp[y][x].mapcell=o;updatemap(x,y);o.removeAttribute("id");o.setAttribute("transform","translate("+((x*18)+32)+" "+((y*18)+34)+")");o.onmouseenter=_=>{fuelneed=calcfuel(_.target.d);text("Warp requires "+fuelneed+"mgb.  Fuel available: "+fuel+"mgb");if(fuelneed<=fuel){_.target.setAttribute("stroke","#fff")}else{_.target.setAttribute("stroke","#f00")}};o.onmouseleave=_=>{if(_.target.d.x==ship.d.mx&&_.target.d.y==ship.d.my){_.target.setAttribute("stroke","#ff0")}else{_.target.setAttribute("stroke","#fff2")}};o.onclick=_=>{fuelneed=calcfuel(_.target.d);if(fuelneed<=fuel){fuel-=fuelneed;warpdistance=fuelneed*100;ship.d.mx=_.target.d.x;ship.d.my=_.target.d.y;_.target.setAttribute("stroke","#ff0");shipcell.setAttribute("stroke","#fff2");shipcell=_.target;showwarp()}};map.appendChild(o)}};for(i=0;i<8;++i){o=box.cloneNode();o.setAttribute("stroke","#fff");o.setAttribute("stroke-width","0.3");o.removeAttribute("id");o.d={r:90,x:-200,y:-200,z:1,t:null};o.d.u=(o,g)=>{if(mousedown||missiletime>0){if(o.d.t){o.d.x=o.d.t.x;o.d.y=o.d.t.y;o.d.r=o.d.r*0.75;o.d.z=(4+o.d.z)/2}}else{if(o.d.t!=null){if(maxmissiles-missiles>0){if(missiletime==0){m=firemissile();m.d.x=ship.d.x;m.d.y=ship.d.y;m.d.t=o.d.t;m.d.to=o.d.to;o.d.t=null;o.d.x=-100;o.d.y=-100;targets.push(o)}}}};u(o)};targets.push(o);u(o);l11.appendChild(o)};firemissile=_=>{missiles++;o=box.cloneNode();o.setAttribute("stroke","#fff");o.setAttribute("stroke-width","2");o.removeAttribute("id");o.d={r:0,x:-200,y:-200,z:1,t:null,f:0};o.d.u=(o,g)=>{if(o.d.t&&!o.d.t.d){o.d.x=(o.d.x*0.85)+(o.d.t.x*0.15);o.d.y=(o.d.y*0.85)+(o.d.t.y*0.15);o.d.z=o.d.z*0.95;o.d.f++;if(o.d.z<0.001){o.d.d=true};if(o.d.f>20&&(Math.abs(o.d.x-o.d.t.x)+Math.abs(o.d.y-o.d.t.y))<50){fx2();o.d.d=true;o.d.t.d=true;d(o.d.to);enemies--;missiles--};u(o)}};u(o);l11.appendChild(o);objects.push(o);fx3();missiletime=4;return o};enemywave1=_=>{fx4();s=0.1;wavecount++;r=Math.floor(Math.random()*10);for(i=0;i<wavecount*2;++i){o=enemybox.cloneNode();o.removeAttribute("id");o.setAttribute("d",a());o.setAttribute("fill",cols[(i+r)%cols.length]);o.onmouseenter=_=>{if(mousedown&&shields>0){if(targets.length>0){t=targets.pop();t.d.t=_.target.d;t.d.to=_.target;t.d.z=1000;t.d.r=90;objects.push(t);fx1(700+(50*targetc));_.target.onmouseenter=null;targetc++}}};o.d={r:0,x:Math.random()*640,ry:Math.random()*640,s:s+=0.0005,z:0.1,dx:0,dy:0};o.d.u=(o,g)=>{o.d.dx=o.d.x;o.d.dy=o.d.ry;o.d.x=(o.d.x*(1-o.d.s))+(g.x*o.d.s);o.d.ry=(o.d.ry*(1-o.d.s))+(g.y*o.d.s);o.d.dx=o.d.x-o.d.dx;o.d.dy=o.d.ry-o.d.dy;o.d.z=(o.d.z*0.95)+(5.0+Math.sin(n-(o.d.s*500)))*0.05;if(Math.random()*1000<wavecount*10){zap=ground.cloneNode();zap.removeAttribute("id");zap.setAttribute("filter","url(#g)");p="M0 0";for(k=1;k<65;k++){p+=` L${(Math.random()*k*2)-k} ${k*10}`};zap.setAttribute("d",p);zap.d={x:o.d.x,y:o.d.y,r:0,s:1,z:1,d:true};zap.d.u=_=>{};objects.push(zap);u(zap);l12.appendChild(zap);if(Math.abs(o.d.x-ship.d.x)<25){shields--;fx6()}else{fx5()}};if(!o.d.d){o.d.y=250-o.d.ry+gh*(o.d.z*2);g.x=o.d.x;g.y=o.d.ry}else{o.d.y=-100};u(o)};objects.push(o);enemies++;l12.appendChild(o)}};slices=20;div=10;for(i=0;i<slices;++i){o=ground.cloneNode();o.removeAttribute("id");o.d={i:i+2};o.d.u=(o,g)=>{s="";for(x=0;x<=64;++x){rx=((32-x)*((slices+1-o.d.i)/10))/div;hz=g.sn.n(g.gx+rx,(o.d.i+g.gy)/div);sq=o.d.i*o.d.i;s+=x==0?"M":"L";s+=`${x*10} ${(100-(gh*3))+((gh/slices)*sq)+(hz*sq/2)}`};o.setAttribute("d",s);o.setAttribute("stroke",fmp[ship.d.my][ship.d.mx].pcol);l10.appendChild(o)};objects.push(o)};missiletime=0;gameloop=false;warpdistance=10000;focus=true;window.onfocus=_=>focus=true;window.onblur=_=>focus=false;n=0;cursor.d={r:0,x:320,y:320,z:1};cursor.d.u=(o,g)=>{o.d.x=320+(mx*320);o.d.y=320+(my*320);u(o)};fxobjects.push(cursor);u(cursor);vsync.d={r:0,x:0,y:0,z:1};vsync.d.u=(o,g)=>{o.d.y+=16;if(o.d.y>640)o.d.y=-200;u(o)};fxobjects.push(vsync);showtitle();c.onmousedown=_=>{focus=true;mousedown=gameloop};c.onmouseup=_=>{if(gameloop){mousedown=false;missiletime=0;targetc=0}};mx=0;my=0;rect=c.getBoundingClientRect();window.onresize=_=>rect=c.getBoundingClientRect();c.onmousemove=_=>{size=Math.min(rect.width,rect.height)/2;mx=_clamp_(((_.clientX-rect.left)-(rect.width/2))/size,-1,1);my=_clamp_(((_.clientY-rect.top)-(rect.height/2))/size,-1,1)};gx=100;gy=0;gh=10;setInterval(_=>{if(!focus)return;fxobjects.forEach(o=>{o.d.u(o,g)});if(!gameloop)return;n+=0.025;gy-=1;if(missiletime>0)missiletime--;g={x:320+(Math.sin(n)*150),y:200+(Math.cos(n)*150),gy:gy,gx:gx,gh:gh,sn:sn};objects2=objects;objects=[];objects2.forEach(o=>{o.d.u(o,g);if(o.d.d){o.remove()}else{objects.push(o)}});if(enemies==0){wavetime--;if(wavetime==0){if(waves==0){showtrade()}else{waves--;wavetime=25;enemywave1()}}};if(shields>0){text(`shields: ${shields}%`)}else{text("G A M E O V E R");ship.d.d=true;fx7();shields=0}},50);fx=(...t)=>fxP(fxG(...t));fxP=(...t)=>{let e=fxX.createBufferSource(),f=fxX.createBuffer(t.length,t[0].length,fxR);t.map((d,i)=>f.getChannelData(i).set(d)),e.buffer=f,e.connect(fxX.destination),e.start();return e};fxG=(q=1,k=.05,c=220,e=0,t=0,u=.1,r=0,F=1,v=0,z=0,w=0,A=0,l=0,B=0,x=0,G=0,d=0,y=1,m=0,C=0)=>{let b=2*Math.PI,H=v*=500*b/fxR**2,I=(0<x?1:-1)*b/4,D=c*=(1+2*k*Math.random()-k)*b/fxR,Z=[],g=0,E=0,a=0,n=1,J=0,K=0,f=0,p,h;e=99+fxR*e;m*=fxR;t*=fxR;u*=fxR;d*=fxR;z*=500*b/fxR**3;x*=b/fxR;w*=b/fxR;A*=fxR;l=fxR*l|0;for(h=e+m+t+u+d|0;a<h;Z[a++]=f)++K%(100*G|0)||(f=r?1<r?2<r?3<r?Math.sin((g%b)**3):Math.max(Math.min(Math.tan(g),1),-1):1-(2*g/b%2+2)%2:1-4*Math.abs(Math.round(g/b)-g/b):Math.sin(g),f=(l?1-C+C*Math.sin(2*Math.PI*a/l):1)*(0<f?1:-1)*Math.abs(f)**F*q*fxV*(a<e?a/e:a<e+m?1-(a-e)/m*(1-y):a<e+m+t?y:a<h-d?(h-a-d)/u*y:0),f=d?f/2+(d>a?0:(a<h-d?1:(h-a)/d)*Z[a-d|0]/2):f),p=(c+=v+=z)*Math.sin(E*x-I),g+=p-p*B*(1-1E9*(Math.sin(a)+1)%2),E+=p-p*B*(1-1E9*(Math.sin(a)**2+1)%2),n&&++n>A&&(c+=w,D+=w,n=0),!l||++J%l||(c=D,v=H,n=n||1);return Z};fxV=.3;fxR=44100;fxX=new(top.AudioContext);fxM=(n,f,t,e=125)=>{let l,o,z,r,g,h,x,a,u,c,d,i,m,p,G,M=0,R=[],b=[],j=[],k=0,q=0,s=1,v={},w=fxR/e*60>>2;for(;s;k++)R=[s=a=d=m=0],t.map((e,d)=>{for(x=f[e][k]||[0,0,0],s|=!!f[e][k],G=m+(f[e][0].length-2-!a)*w,p=d==t.length-1,o=2,r=m;o<x.length+p;a=++o){for(g=x[o],u=o==x.length+p-1&&p||c!=(x[0]||0)|g|0,z=0;z<w&&a;z++>w-99&&u?i+=(i<1)/99:0)h=(1-i)*R[M++]/2||0,b[r]=(b[r]||0)-h*q+h,j[r]=(j[r++]||0)+h*q+h;g&&(i=g%1,q=x[1]||0,(g|=0)&&(R=v[[c=x[M=0]||0,g]]=v[[c,g]]||(l=[...n[c]],l[2]*=2**((g-12)/12),g>0?fxG(...l):[])))}m=G});return[b,j]};fx0=fxM(...[[[.7,0,22,,.07,.07,2,0,,,.5,.01],[.5,0,196,,2,.5,3],[,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[,0,84,,,,,.7,,,,.5,,6.7,1,.05],[3,0,43,,,.25,,,,,,,,2],[.75,0,196,,.08,.18,3]],[[[1,1,8,,,,,,,,,,,,8,,,,,,,,,,,,8,,,,,,,,6,,,,,,,,,,,6,,,,,,,,,,,,,6,,,,,,,,],[,-1,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,],[3,1,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,],[4,1,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,,,],[2,1,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,18,18,18]],[[5,-1,20,,20.5,,15.75,,20.75,,20,,20.5,,20,,15,,20.5,,15.75,,20.75,,15,,18,,20,,20.5,,18,,18.5,,22.75,,18.75,,18,,17,,15,,20.75,,18,,18.5,,22.75,,18.75,,22.75,,18.75,,22.92,,18.92,,22.92,,],[1,1,8,,,,,,,,,,,,8,,,,,,,,,,,,8,,,,,,,,6,,,,,,,,,,,6,,,,,,,,,,,,,6,,,,,,,,],[,-1,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,],[3,1,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,],[4,1,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,,,],[2,1,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,18,18,18]],[[5,-1,15,,10.5,,13,,15,,10.5,,13,,15,,18,,13.5,,18,,13.5,,18,,17,,15,,13,,15,,15,,10.5,,13,,15,,10.5,,13,,15,,18,,13.5,,18,,13.5,,18,,17,,15,,13,,15,,],[1,1,8,,,,,,,,,,,,8,,,,,,,,,,,,8,,,,,,,,6,,,,,,,,,,,6,,,,,,,,,,,,,6,,,,,,,,],[,-1,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,],[3,1,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,],[4,1,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,,,],[2,1,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,18,18,18]],[[5,-1,10,,8.5,,10.75,,8.75,,10.75,,8.75,,10.75,,8.75,,10.75,,8.75,,10.75,,8.75,,10.75,,8.75,,10.75,,8.75,,8,,6.5,,8.75,,6.75,,8.75,,6.75,,8.75,,6.75,,8.75,,6.75,,8.75,,6.75,,8.75,,6.75,,8.75,,6.75,,],[1,1,8,,,,,,,,,,,,8,,,,,,,,,,,,8,,,,,,,,6,,,,,,,,,,,6,,,,,,,,,,,,,6,,,,,,,,],[,-1,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,],[3,1,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,],[4,1,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,,,],[2,1,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,18,18,18]],[],[[5,-1,20,,15.5,,20.5,,15.75,,20.75,,15.75,,20.75,,15.75,,20.75,,15.75,,20.75,,15.75,,18,,18.75,,17,,17.75,,15,,10.5,,15.75,,10.75,,15.75,,10.75,,15.75,,10.75,,15.75,,10.75,,15.75,,10.75,,15.92,,10.92,,15.92,,10.92,,],[,1,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,],[1,-1,8,,,,,,,,,,,,8,,,,,,,,,,,,8,,,,,,,,6,,,,,,,,,,,6,,,,,,,,,,,,,6,,,,,,,,],[3,1,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,],[4,1,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,,,],[2,1,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,18,18,18]],[[5,-1,20,,15.5,,20.75,,15.75,,20.75,,15.75,,20.75,,15.75,,20,,15.5,,20.75,,15.75,,18,,18.5,,18.75,,18.75,,18,,22.5,,18.75,,22.75,,18.75,,22.75,,18.75,,22.75,,15,,10.5,,15,,22.5,,15.75,,22.75,,15,,22.75,,],[1,1,8,,,,,,,,,,,,8,,,,,,,,,,,,8,,,,,,,,6,,,,,,,,,,,6,,,,,,,,,,,,,6,,,,,,,,],[,-1,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,15,,,,13,,15,,,,13,,15,,18,,,,18,,,,18,,17,,15,,13,,15,,],[3,1,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,20,,,,,,,,],[4,1,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,24,,,,,,],[2,1,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,,,,,,,,18,18,18,,]]],[0,0,5,6,6,2,2,1,1,6,6,2,2,1,1,6,5,3],120,{}]);fx1=f=>fx(...[,,f,.02,,.08,1,1.19,11,,-344,.02,,,,,,.04,.02]);fx2=_=>fx(...[,,585,.01,.23,.21,4,4.87,,,,,,.4,,.3,,.76,.13,.44]);fx3=_=>fx(...[,,169,.02,,.24,1,.77,.2,,,,,2.1,,.1,,.93,.09,.02]);fx4=_=>fx(...[,,388,.38,.4,.66,,1.46,.5,-3.8,4,.02,.15,,,,,.61,.02]);fx6=_=>fx(...[,,603,.02,,.14,4,1.36,-0.6,.5,,,,,,,.05,.68,.08,.39]);fx5=_=>fx(...[,,409,.02,,.21,,.64,-0.4,.3,,,,,,,.2,.61,.05,.21]);fx7=_=>fx(...[,,533,,3,3,3,3.49,.5,.4,,,,.6,.2,.2,,.6,1])</script>